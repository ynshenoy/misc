ADMIN_TOKEN=123
AUTH_URL=http://192.168.100.1:5000/v3
echo "Creating admin_domain..."

export ID_ADMIN_DOMAIN=$(\
curl $AUTH_URL/domains \
    -s \
    -H "X-Auth-Token: $ADMIN_TOKEN" \
    -H "Content-Type: application/json" \
    -d '
{
    "domain": {
    "enabled": true,
    "name": "admin_domain"
    }
}' | jq .domain.id | tr -d '"' )

echo "ID of admin_domain: $ID_ADMIN_DOMAIN"

echo "Creating cloud_admin..." 

ID_CLOUD_ADMIN=$(\
curl $AUTH_URL/users \
    -s \
    -H "X-Auth-Token: $ADMIN_TOKEN" \
    -H "Content-Type: application/json" \
    -d "
{
    \"user\": {
        \"description\": \"Cloud administrator\",
        \"domain_id\": \"$ID_ADMIN_DOMAIN\",
        \"enabled\": true,
        \"name\": \"cloud_admin\",
        \"password\": \"password\"
    }
}" | jq .user.id | tr -d '"' )

echo "ID of cloud_admin is: $ID_CLOUD_ADMIN"

echo "Getting id of admin role..."

ADMIN_ROLE_ID=$(\
curl $AUTH_URL/roles?name=admin \
    -s \
    -H "X-Auth-Token: $ADMIN_TOKEN" \
| jq .roles[0].id | tr -d '"' )

echo "ID of admin role is: $ADMIN_ROLE_ID"

echo "Putting admin role for cloud_admin in admin_domain"

curl -X PUT $AUTH_URL/domains/${ID_ADMIN_DOMAIN}/users/${ID_CLOUD_ADMIN}/roles/${ADMIN_ROLE_ID} \
    -s \
    -i \
    -H "X-Auth-Token: $ADMIN_TOKEN" \
    -H "Content-Type: application/json"
